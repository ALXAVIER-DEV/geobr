system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 800) %>% st_transform(crs=4674) )
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
plot(a)
plot(c)
a <- geobr::read_metro_area(year=2013, tp = "simplified")
mapview(a)
a <- geobr::read_metro_area(year=2013, tp = "simplified")
b <- geobr::read_metro_area(year=2013, tp = "original")
a <- subset(a, name_metro == "RM São Paulo")
b <- subset(b, name_metro == "RM São Paulo")
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
plot(b)
plot(a)
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
plot(b)
plot(a)
plot(c)
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 400) %>% st_transform(crs=4674) )
plot(b)
plot(a)
plot(c)
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 200) %>% st_transform(crs=4674) )
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
mapview(b) + a + c
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 100) %>% st_transform(crs=4674) )
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
mapview(b) + a + c
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 10) %>% st_transform(crs=4674) )
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
mapview(b) + a + c
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 5) %>% st_transform(crs=4674) )
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
mapview(b) + a + c
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 1) %>% st_transform(crs=4674) )
plot(c)
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
mapview(b) + a + c
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 0) %>% st_transform(crs=4674) )
mapview(b) + a + c
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = -1) %>% st_transform(crs=4674) )
library(rgrass7)
install.packages('rgrass7')
library(rgrass7)
# simplify
system.time(  c <- st_transform(a, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 200) %>% st_transform(crs=4674) )
plot(b)
plot(a)
plot(c)
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
mapview(b) + a + c
library(rmapshaper)
st_transform(a, crs=3857) %>% rmapshaper::ms_simplify(preserveTopology = T, dTolerance = 200)
system.time(  c <- st_transform(a, crs=3857) %>% rmapshaper::ms_simplify() %>% st_transform(crs=4674) )
plot(c)
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
c <- a  %>% rmapshaper::ms_simplify()
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
plot(a)
plot(c)
system.time(  c <- st_transform(a, crs=3857)  %>% rmapshaper::ms_simplify(keep = 0.001) %>% st_transform(crs=4674) )
plot(c)
system.time(  c <- st_transform(a, crs=3857)  %>% rmapshaper::ms_simplify(keep = 0.1) %>% st_transform(crs=4674) )
plot(c)
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
system.time(  c <- st_transform(a, crs=3857)  %>% rmapshaper::ms_simplify(keep = 1) %>% st_transform(crs=4674) )
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
plot(a)
plot(c)
plot(b)
plot(a)
plot(c)
head(c)
system.time(  c <- a %>% rmapshaper::ms_simplify(keep = 1) )
plot(c)
system.time(  c <- b %>% rmapshaper::ms_simplify(keep = 1) )
plot(c)
as.numeric(object.size(a)) / as.numeric(object.size(b)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(b)) # reducao em __ vezes
o <- geobr::read_metro_area(year=2013, tp = "original")
a <- geobr::read_metro_area(year=2013, tp = "simplified")
o <- subset(b, name_metro == "RM São Paulo")
o <- subset(o, name_metro == "RM São Paulo")
a <- subset(a, name_metro == "RM São Paulo")
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
mapview(o) + a + b
system.time(  b <- o %>% rmapshaper::ms_simplify(keep = 1) )
as.numeric(object.size(a)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
mapview(o) + a + b
system.time(  b <- o %>% rmapshaper::ms_simplify(keep = 100) )
system.time(  b <- o %>% rmapshaper::ms_simplify(keep = .5) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(a)) / as.numeric(object.size(o)) # reducao em __ vezes
plot(b)
system.time(  b <- o %>% rmapshaper::ms_simplify(keep = .9) )
plot(b)
# download data
o <- geobr::read_metro_area(year=2013, tp = "original")
o <- subset(o, name_metro == "RM São Paulo")
head(o)
b <- rmapshaper::ms_simplify(o, keep = .9)
head(b)
system.time(  b <- st_transform(o, crs=3857)  %>% rmapshaper::ms_simplify(keep = 1) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
plot(a)
plot(b)
system.time(  b <- st_transform(o, crs=3857)  %>% rmapshaper::ms_simplify(keep = .1) %>% st_transform(crs=4674) )
plot(b)
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
plot(b)
system.time(  b <- st_transform(o, crs=3857)  %>% rmapshaper::ms_simplify(keep = .1) %>% st_transform(crs=4674) )
system.time(  c <- o %>% rmapshaper::ms_simplify(keep = .1) )
identical(b, c)
head(b)
head(c)
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(o)) # reducao em __ vezes
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = .1) %>% st_transform(crs=4674) )
system.time(  b <- st_transform(o, crs=3857)  %>% rmapshaper::ms_simplify(keep = .5) %>% st_transform(crs=4674) )
o <- geobr::read_metro_area(year=2013, tp = "original")
a <- geobr::read_metro_area(year=2013, tp = "simplified")
o <- subset(o, name_metro == "RM São Paulo")
a <- subset(a, name_metro == "RM São Paulo")
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = .1) %>% st_transform(crs=4674) )
system.time(  c <- st_transform(o, crs=3857)  %>% rmapshaper::ms_simplify(keep = .5) %>% st_transform(crs=4674) )
identical(b, c)
as.numeric(object.size(a)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(o)) # reducao em __ vezes
mapview(o) + a + b + c
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(c)) / as.numeric(object.size(o)) # reducao em __ vezes
plot(c)
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(a)) / as.numeric(object.size(o)) # reducao em __ vezes
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
as.numeric(object.size(a)) / as.numeric(object.size(o)) # reducao em __ vezes
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
plot(b)
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 5000) %>% st_transform(crs=4674) )
plot(b)
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 5000) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
mapview(b)
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 50) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
mapview(b)
b2 <- lwgeom::st_make_valid(b)
as.numeric(object.size(b2)) / as.numeric(object.size(o)) # reducao em __ vezes
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 5) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
mapview(b)
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 10) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
readr::write_rds(b, 'test_simplified500.gpkg')
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 50) %>% st_transform(crs=4674) )
readr::write_rds(b, 'test_simplified50.gpkg')
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 10) %>% st_transform(crs=4674) )
readr::write_rds(b, 'test_simplified10.gpkg')
readr::write_rds(o, 'test.gpkg')
simplified_files <- list.files('\\storage1\\geobr\\data_gpkg')
simplified_files <- list.files('\\storage1\\geobr\\data_gpkg', recursive = T)
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', recursive = T)
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', pattern = 'simplified', recursive = T)
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg',  recursive = T)
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', pattern = 'simplified', recursive = T)
simplified_files
temp_gpkg <- simplified_files[1]
temp_gpkg
# get address of original file
fil_address <- simplified_files[1]
# get address of original file
file_address <- simplified_files[1]
file_address
stringi::str_replace(file_address, '_simplified.gpkg', '.gpkg')
stringi::str_replace_all(file_address, '_simplified.gpkg', '.gpkg')
stringi::stri_replace(file_address, '_simplified.gpkg', '.gpkg')
gsub('_simplified.gpkg', '.gpkg', file_address)
# get address of original file
file_address <- simplified_files[1]
file_address
file_address <- gsub('_simplified.gpkg', '.gpkg', file_address)
file_address
# read original file
temp_gpkg <- sf::st_read(file_address)
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', pattern = 'simplified', recursive = T, full.names = T)
# get address of original file
file_address <- simplified_files[1]
file_address
file_address <- gsub('_simplified.gpkg', '.gpkg', file_address)
# read original file
temp_gpkg <- sf::st_read(file_address)
temp_gpkg
tolerance=50
library(magrittr)
simplified_files
simplified_files
simplified_files <- simplified_files[1]
# get address of original file
file_address <- simplified_files
file_address <- gsub('_simplified.gpkg', '.gpkg', file_address)
# read original file
temp_gpkg <- sf::st_read(file_address)
file_address
# list all simplified data sets
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', pattern = 'simplified', recursive = T, full.names = T)
simplified_files
simplified_files <- simplified_files[1
# list all simplified data sets
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', pattern = 'simplified', recursive = T, full.names = T)
file_address=simplified_files[1]
file_address
# get address of original file
simplified_file_address <- file_address
original_file_address <- gsub('_simplified.gpkg', '.gpkg', file_address)
# get address of original file
simplified_file_address <- file_address
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
original_file_address
# read original file
temp_gpkg <- sf::st_read(original_file_address)
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = tolerance) %>% st_transform(crs=4674)
temp_gpkg_simplified
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
simplified_file_address
gc()
library(geobr)
library(magrittr)
library(sf)
library(beepr)
library(furrr)
library(mapview)
library(rmapshaper)
library(magrittr)
o <- geobr::read_metro_area(year=2013, tp = "original")
a <- geobr::read_metro_area(year=2013, tp = "simplified")
o <- subset(o, name_metro == "RM São Paulo")
a <- subset(a, name_metro == "RM São Paulo")
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674) )
# save data
sf::st_write(o, 'test.gpkg')
sf::st_write(b, 'test_simplified500.gpkg')
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 50) %>% st_transform(crs=4674) )
sf::st_write(b, 'test_simplified50.gpkg')
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 10) %>% st_transform(crs=4674) )
sf::st_write(b, 'test_simplified10.gpkg')
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 50) %>% st_transform(crs=4674) )
as.numeric(object.size(b)) / as.numeric(object.size(o)) # reducao em __ vezes
mapview(o) + a + b
b <- lwgeom::st_make_valid(b)
mapview(o) + a + b
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', pattern = 'simplified', recursive = T, full.names = T)
file_address <- simplified_files[1]
tolerance=50
# get address of original file
simplified_file_address <- file_address
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
simplified_file_address
simplified_files
# get address of original file
simplified_file_address <- file_address <- simplified_files[84]
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
# read original file
temp_gpkg <- sf::st_read(original_file_address)
head(temp_gpkg)
plot(temp_gpkg)
simplified_file_address
# get address of original file
simplified_file_address <- file_address <- simplified_files[106]
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
source('L:/# RAFAEL HENRIQUE MORAES PEREIRA #/git/geobr/r-package/prep_data/tests_st_simplify.R', encoding = 'UTF-8', echo=TRUE)
simplified_file_address
original_file_address
# read original file
temp_gpkg <- sf::st_read(original_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = tolerance) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
simplified_file_address
sf::st_write(temp_gpkg_simplified, simplified_file_address)
mapview(temp_gpkg_simplified)
# simplify
system.time(  b <- st_transform(o, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 100) %>% st_transform(crs=4674) )
# Make any invalid geometry valid # st_is_valid( sf)
b <- lwgeom::st_make_valid(b)
sf::st_write(b, 'test_simplified100.gpkg')
mapview(b)
tolerance=100
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = tolerance) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
library(magrittr)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
# read original file
temp_gpkg <- sf::st_read(original_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address, overwrite = T)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address, overwrite = T)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 100) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 50) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 200) %>% st_transform(crs=4674)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 200) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 200) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
as.numeric(object.size(temp_gpkg_simplified)) / as.numeric(object.size(temp_gpkg)) # reducao em __ vezes
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 100) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
as.numeric(object.size(temp_gpkg_simplified)) / as.numeric(object.size(temp_gpkg)) # reducao em __ vezes
mapview(temp_gpkg_simplified)
simplified_files
# get address of original file
simplified_file_address <- file_address <- simplified_files[1]
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
original_file_address
head(simplified_files)
# get address of original file
simplified_file_address <- file_address <- simplified_files[3]
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
original_file_address
# read original file
temp_gpkg <- sf::st_read(original_file_address)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 500) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
as.numeric(object.size(temp_gpkg_simplified)) / as.numeric(object.size(temp_gpkg)) # reducao em __ vezes
mapview(temp_gpkg)
head(temp_gpkg_simplified)
mapview(temp_gpkg) + temp_gpkg_simplified
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 100) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
as.numeric(object.size(temp_gpkg_simplified)) / as.numeric(object.size(temp_gpkg)) # reducao em __ vezes
class(temp_gpkg_simplified)
# simplify with tolerance
temp_gpkg_simplified <- st_transform(temp_gpkg, crs=3857) %>% sf::st_simplify(preserveTopology = T, dTolerance = 100) %>% st_transform(crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
as.numeric(object.size(temp_gpkg_simplified)) / as.numeric(object.size(temp_gpkg)) # reducao em __ vezes
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address, quiet = TRUE)
mapview(temp_gpkg) + temp_gpkg_simplified
sf::st_write(temp_gpkg_simplified, simplified_file_address, quiet = TRUE)
# delete previous file
file.remove(simplified_file_address)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address, quiet = TRUE)
simplify_gpkg <- function(file_address, tolerance=100){
# get address of original file
simplified_file_address <- file_address
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
# read original file
temp_gpkg <- sf::st_read(original_file_address)
# simplify with tolerance
temp_gpkg_simplified <- sf::st_transform(temp_gpkg, crs=3857)
temp_gpkg_simplified <- sf::st_simplify(temp_gpkg_simplified, preserveTopology = T, dTolerance = tolerance)
temp_gpkg_simplified <- sf::st_transform(temp_gpkg_simplified, crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
as.numeric(object.size(temp_gpkg_simplified)) / as.numeric(object.size(temp_gpkg)) # reducao em __ vezes
mapview(temp_gpkg) + temp_gpkg_simplified
# delete previous file
file.remove(simplified_file_address)
# save simplified file
sf::st_write(temp_gpkg_simplified, simplified_file_address, quiet = TRUE)
}
simplify_gpkg( simplified_files[3] )
simplify_gpkg <- function(file_address, tolerance=100){
# get address of original file
simplified_file_address <- file_address
original_file_address <- gsub('_simplified.gpkg', '.gpkg', simplified_file_address)
# read original file
temp_gpkg <- sf::st_read(original_file_address)
# simplify with tolerance
temp_gpkg_simplified <- sf::st_transform(temp_gpkg, crs=3857)
temp_gpkg_simplified <- sf::st_simplify(temp_gpkg_simplified, preserveTopology = T, dTolerance = tolerance)
temp_gpkg_simplified <- sf::st_transform(temp_gpkg_simplified, crs=4674)
# Make any invalid geometry valid # st_is_valid( sf)
temp_gpkg_simplified <- lwgeom::st_make_valid(temp_gpkg_simplified)
as.numeric(object.size(temp_gpkg_simplified)) / as.numeric(object.size(temp_gpkg)) # reducao em __ vezes
mapview(temp_gpkg) + temp_gpkg_simplified
# delete previous file
message('deleting old file')
file.remove(simplified_file_address)
# save simplified file
message('saving new file')
sf::st_write(temp_gpkg_simplified, simplified_file_address, quiet = TRUE)
}
simplify_gpkg( simplified_files[3] )
simplified_file_address
temp_gpkg_simplified
sf::st_write(temp_gpkg_simplified, simplified_file_address, quiet = TRUE)
simplify_gpkg( simplified_files[3] )
library(geobr)
library(magrittr)
library(sf)
library(beepr)
library(furrr)
library(mapview)
library(rmapshaper)
library(magrittr)
# list all simplified data sets
simplified_files <- list.files(path = '//storage1/geobr/data_gpkg', pattern = 'simplified', recursive = T, full.names = T)
simplified_files
simplified_files
